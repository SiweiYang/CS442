<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>13&nbsp;Q13 (posted Mar 10, due Mar 21)</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="scribble-style.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">CS 442 Assignment Questions</a></td></tr></table></div><div class="tocviewsublistonly" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Q1__posted_Jan_14__due_Jan_21_.html" class="tocviewlink" data-pltdoc="x">Q1 (posted Jan 14, due Jan 21)</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Q2__posted_Jan_14__due_Jan_31_.html" class="tocviewlink" data-pltdoc="x">Q2 (posted Jan 14, due Jan 31)</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Q3__posted_Jan_25__due_Feb_5_.html" class="tocviewlink" data-pltdoc="x">Q3 (posted Jan 25, due Feb 5)</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Q4__posted_Feb_3__due_Feb_10_.html" class="tocviewlink" data-pltdoc="x">Q4 (posted Feb 3, due Feb 10)</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Q5__posted_Feb_3__due_Feb_12_.html" class="tocviewlink" data-pltdoc="x">Q5 (posted Feb 3, due Feb 12)</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Q6__posted_Feb_3__due_Feb_14_.html" class="tocviewlink" data-pltdoc="x">Q6 (posted Feb 3, due Feb 14)</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Q7__posted_Feb_10__due_Feb_24_.html" class="tocviewlink" data-pltdoc="x">Q7 (posted Feb 10, due Feb 24)</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Q8__posted_Feb_10__due_Feb_24_.html" class="tocviewlink" data-pltdoc="x">Q8 (posted Feb 10, due Feb 24)</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="Q9__posted_Feb_10__due_Feb_24_.html" class="tocviewlink" data-pltdoc="x">Q9 (posted Feb 10, due Feb 24)</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="Q10__posted_Feb_10__due_Feb_24_.html" class="tocviewlink" data-pltdoc="x">Q10 (posted Feb 10, due Feb 24)</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="Q11__posted_Mar_1__due_Mar_7_.html" class="tocviewlink" data-pltdoc="x">Q11 (posted Mar 1, due Mar 7)</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="Q12__posted_Mar_10__due_Mar_17_.html" class="tocviewlink" data-pltdoc="x">Q12 (posted Mar 10, due Mar 17)</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Q13 (posted Mar 10, due Mar 21)</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="Q14__posted_Mar_14__due_Mar_24_.html" class="tocviewlink" data-pltdoc="x">Q14 (posted Mar 14, due Mar 24)</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="Q15__posted_Mar_14__due_Mar_26_.html" class="tocviewlink" data-pltdoc="x">Q15 (posted Mar 14, due Mar 26)</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="Q16__posted_Mar_14__due_March_28_.html" class="tocviewlink" data-pltdoc="x">Q16 (posted Mar 14, due March 28)</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="Q17__posted_Mar_17__due_Apr_1_.html" class="tocviewlink" data-pltdoc="x">Q17 (posted Mar 17, due Apr 1)</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft">&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="Q12__posted_Mar_10__due_Mar_17_.html" title="backward to &quot;12 Q12 (posted Mar 10, due Mar 17)&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;CS 442 Assignment Questions&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Q14__posted_Mar_14__due_Mar_24_.html" title="forward to &quot;14 Q14 (posted Mar 14, due Mar 24)&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>13<tt>&nbsp;</tt><a name="(part._.Q13__posted_.Mar_10__due_.Mar_21_)"></a>Q13 (posted Mar 10, due Mar 21)</h3><script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><p><span style="font-weight: bold">Language:</span> Haskell. In this and subsequent questions, you may use
the modules <span class="stt">Data.List</span> and <span class="stt">Data.Char</span>. Do not include <span class="stt">main</span>
unless specifically asked to by the question.</p><p><span style="font-weight: bold">Weight:</span> 2.0</p><p>The purpose of this question is to get you used to working with Haskell,
and to make it clear that, for interpreters, the choices of dynamic/static typing and
lazy/eager evaluation are independent for interpreted language and implementation language.
In Q3, you wrote an interpreter in Racket for a Racket-like language.
Here we will revisit that task, but using Haskell for the implementation language.
We&rsquo;ll skip the parsing step and focus on the interpreter, which consumes a
abstract syntax tree (using datatypes very similar to the ones we used
in Q4-11) and an environment, and produces a value. Functions
have exactly one argument, and the interpreter also supports lists. The Haskell
datatypes are below (also given in the starter file).</p><p><table cellspacing="0"><tr><td><p><span class="stt">data BinOp = Plus | Times | Sub | Div | Cons deriving (Eq,Show)</span></p></td></tr><tr><td><p><span class="stt">data UnOp = IsEmpty | IsZero | Fst | Rst deriving (Eq,Show)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">data Ast = NumLit Integer</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| BoolLit Bool</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| EmptyLit</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| UnApp UnOp Ast</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| BinApp BinOp Ast Ast</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| If Ast Ast Ast</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| Fun String Ast</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| Var String</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| App Ast Ast</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| Let String Ast Ast</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| Letrec String Ast Ast</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">deriving (Eq,Show)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">data List = Empty | Kons Val List deriving (Eq,Show)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">data Val = Number Integer | Truthy Bool | Lst List</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| Closure String Ast Env deriving (Eq,Show)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">type Env = [(String, Val)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">interp ::</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Ast -&gt; Env -&gt; Val</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr></table></p><p>Your task is to complete the definition of <span class="stt">interp</span>.
The Marmoset tests will define a <span class="stt">main</span> that
applies <span class="stt">interp</span> to a test expression.
You should raise (using <span class="stt">error</span>) the exact errors
"unbound" (<span class="stt">Var</span> lookup failure), "not a number" (operand of arithmetic
primitive or <span class="stt">IsZero</span>), "not a Boolean" (test of <span class="stt">If</span>),
"not a function" (rator of <span class="stt">App</span>),
"not a list" (second operand of <span class="stt">Cons</span>, operand of <span class="stt">IsEmpty</span>, <span class="stt">Fst</span>, <span class="stt">Rst</span>),
"not a non-empty list" (operand of <span class="stt">Fst</span>, <span class="stt">Rst</span>).</p><p>You don&rsquo;t need to use anything beyond slide 40 of lecture module 04 to do this question,
(though you can if you want) with the exception of what is discussed below.
If nothing else, you may wish to use HUnit
to streamline your tests. It is not easy to use HUnit with test expressions
that are supposed to raise an error (it requires catching exceptions,
which we have not discussed), and those you may choose to handle separately.</p><p>The implementation of <span class="stt">letrec</span> in Q3 used mutation
to create a data structure with a cycle, but laziness
can be used in Haskell. However, we must be careful about
laziness elsewhere in our interpreter.</p><p>Recall that if an expression is reducible to
a value using call-by-value evaluation, lazy evaluation will produce the same answer.
But if the expression diverges or produces an error with call-by-value evaluation,
it may not do so using lazy evaluation. Consider the following simple example:</p><p><table cellspacing="0"><tr><td><p><span class="stt">let y = undefined in 3</span></p></td></tr></table></p><p>This produces 3 when evaluated using GHCi. The equivalent in Racket should produce
an error. We can force Racket-like behaviour in Haskell by using a <span style="font-weight: bold">bang pattern</span>:</p><p><table cellspacing="0"><tr><td><p><span class="stt">let !y = undefined in 3</span></p></td></tr></table></p><p>This produces an error. Bang patterns are not enabled by default, but you
can enable them in your program by adding the following line at the beginning:</p><p><table cellspacing="0"><tr><td><p><span class="stt">{-# LANGUAGE BangPatterns #-}</span></p></td></tr></table></p><p>Judicious use of bang patterns (which can be used anywhere that a regular pattern can
be used) can ensure that your solution
really does implement call-by-value semantics for the interpreted language.
There&rsquo;s no need to overuse them, though.
The model solution only uses a couple of bang patterns.</p><p>In a later question, you will implement an interpreter that
uses call-by-name semantics in the interpreted language.</p><p><span style="font-weight: bold">To submit:</span> <span class="stt">Q13.hs</span>.</p><div class="navsetbottom"><span class="navleft">&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="Q12__posted_Mar_10__due_Mar_17_.html" title="backward to &quot;12 Q12 (posted Mar 10, due Mar 17)&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;CS 442 Assignment Questions&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Q14__posted_Mar_14__due_Mar_24_.html" title="forward to &quot;14 Q14 (posted Mar 14, due Mar 24)&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>